<html>
    <head>
        <title>CountIt v0.1.1</title>
        
        <style>
        button, div, input, label {
            font-size: 20px;
            font-family: sans-serif;
        }

        button {

            height: 50px;
            font-size: 20px;
            margin-bottom: 5px;
            
            cursor: pointer;
        }
            
            #count {
                width: 225px;
            }
            
            #copy {
                width: 150px;
            }

        textarea {width: 500px; height: 300px;}

        .flex-container {
            display: flex;
            flex-direction: row;
            flex-wrap: nowrap;

            justify-content: center;

            width: 500px;
        }
        .flex-container div {
            width: 167px;
            text-align: center;
        }

        #output * {
            font-size: 50px;
            }
        </style>
    </head>

    <body>
        <textarea id="text"></textarea><br/>
        
        <button onclick="countIt()" id="count">Count</button><button id="copy">Copy</button>
        <input type="checkbox" name="auto-count" id="auto-count" checked><label for="auto-count">Auto count</label>
        
        <div class="flex-container">
            <div>Sentences</div>
            <div>Words</div>
            <div>Characters</div>
        </div>
        <div class="flex-container" id="output">
            <div id="sentence-count" class="outputs">0</div>
            <div id="word-count" class="outputs">0</div>
            <div id="character-count" class="outputs">0</div>
        </div>

        <script>
            // previous value storage.
            var prev = { val: '', s: 0, w: 0, c: 0 };
            
            function countIt() {
                var text = document.getElementById('text').value;

                if (text === prev.val) return false;

                hiLite('sentence-count', false);
                hiLite('word-count', false);
                hiLite('character-count', false);
                

                var sentArr = text.split('. ');
                var sL = 0;
                for (var i = 0; i < sentArr.length; i++) if (sentArr[i].trim().length > 0) sL++;                
                
                var wordArr = text.split(' ');
                var wL = 0;
                for (var i = 0; i < wordArr.length; i++) if (wordArr[i].length > 0) wL++;

                var cL = text.length;

                /*
                TODO paragraph counter

                var paraArr = text.split('.');
                var pL = 0;
                for (var i = 0; i < paraArr.length; i++) if (paraArr[i].trim().length > 0) pL++;

                document.getElementById('paragraph-count').innerHTML = pL;
                */

                // populate values.
                if (sL != prev.s) { document.getElementById('sentence-count') .innerHTML = sL; hiLite('sentence-count', true);  }
                if (wL != prev.w) { document.getElementById('word-count')     .innerHTML = wL; hiLite('word-count', true);      }
                if (cL != prev.c) { document.getElementById('character-count').innerHTML = cL; hiLite('character-count', true); }

                // populate title
                document.title = "CountIt: s=" + sL + ', w=' + wL + ', c=' + cL;

                // populate values into next previous values comparison.
                prev.val = text;
                prev.s = sL;
                prev.w = wL;
                prev.c = cL;

                // unhighlight after timer
                setTimeout(function() {
                    hiLite('sentence-count', false);
                    hiLite('word-count', false);
                    hiLite('character-count', false);

                }, 1000);
            }

            // highlight numbers.
            function hiLite(elId, switchOn) {
                var el = document.getElementById(elId);

                el.style.color = switchOn? 'red' : '';
                el.style.backgroundColor = switchOn? 'lime' : '';
            }
            
            // countIt is called on keyup if #auto-count is checked
            document.getElementById('text').addEventListener('keyup', function() {
                if (document.querySelector('#auto-count').checked) countIt();
            });

            // paste event fires before textarea's value is changed.
            // so it needs a minimal timeout set in order to be able to read text contents.
            // https://stackoverflow.com/a/10972973/5511776
            document.getElementById('text').addEventListener('paste', function() {
                setTimeout(function() {
                    countIt();
                }, 0);
            });
            
            // copy text from #text
            document.querySelector('#copy').onclick = function() {
                document.querySelector('#text').select();
                document.execCommand('copy');
            }
        </script>
    </body>
</html>